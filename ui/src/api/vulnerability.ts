import { fetchCoreService } from "./coreServices";

export type VulnerabilityRecord = {
  vulnerability_id: string;
  asset_id: string;
  risk_score: {
    score: number;
    level: "low" | "medium" | "high" | "critical";
    confidence: number;
    contributors: string[];
  };
  remediation: {
    preferred: string;
    alternatives: string[];
  };
  evidence: {
    captured_at: string;
    detection_source: string;
  };
  exposure_profile: {
    exposure_state: "exposed" | "limited" | "none";
    reachability: "internet" | "internal" | "restricted";
  };
};

export type VulnerabilityListResponse = {
  vulnerabilities: VulnerabilityRecord[];
};

// Vulnerability service surfaces exposure and remediation context.
export const fetchVulnerabilities = async (signal?: AbortSignal): Promise<VulnerabilityRecord[]> => {
  const response = await fetchCoreService<VulnerabilityListResponse>("vulnerability", "/vulnerabilities?limit=200", signal);
  return response.vulnerabilities;
};
